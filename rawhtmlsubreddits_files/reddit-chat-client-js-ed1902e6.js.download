import{aH as t,aG as e,_ as n,e as i,b as s,c as a,o as r,d2 as o,d3 as h,dG as l,W as c,p as u,hX as p,cJ as d,q as m,an as f,ao as g,l as C,d1 as b,bf as v,hY as S,a as x,n as y,t as w}from"./shell-ceb66a5c.js";import{s as k,i as T,A as I,x as R,a3 as $,I as A,cC as P,z as E,du as L,dv as U,c as N}from"./icon-04f6a077.js";import{B as D}from"./badge-84cdd087.js";import"./render-toast-60259ddd.js";import{F as M}from"./faceplate-toaster-92683573.js";import{C as O,a as z}from"./models-a7a2c289.js";import{a as j}from"./feeds-147f777f.js";import{l as _}from"./list-item-b879d870.js";import"./faceplate-menu-210a1c41.js";import{FaceplateDropdownMenu as q}from"./faceplate-dropdown-menu-f1045f04.js";import"./alerts-controller-56dd62ca.js";import"./TinyGesture-6f7cc1aa.js";import"./popper-controller-d9d10574.js";import"./makeEventDispatcher-28989282.js";var F=/[$_\p{ID_Start}]/u,B=/[$_\u200C\u200D\p{ID_Continue}]/u;function H(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function Q(t,e=!1){const n=[];let i=0;for(;i<t.length;){const s=t[i],a=function(s){if(!e)throw new TypeError(s);n.push({type:"INVALID_CHAR",index:i,value:t[i++]})};if("*"!==s)if("+"!==s&&"?"!==s)if("\\"!==s)if("{"!==s)if("}"!==s)if(":"!==s)if("("!==s)n.push({type:"CHAR",index:i,value:t[i++]});else{let e=1,s="",r=i+1,o=!1;if("?"===t[r]){a(`Pattern cannot start with "?" at ${r}`);continue}for(;r<t.length;){if(!H(t[r],!1)){a(`Invalid character '${t[r]}' at ${r}.`),o=!0;break}if("\\"!==t[r]){if(")"===t[r]){if(e--,0===e){r++;break}}else if("("===t[r]&&(e++,"?"!==t[r+1])){a(`Capturing groups are not allowed at ${r}`),o=!0;break}s+=t[r++]}else s+=t[r++]+t[r++]}if(o)continue;if(e){a(`Unbalanced pattern at ${i}`);continue}if(!s){a(`Missing pattern at ${i}`);continue}n.push({type:"PATTERN",index:i,value:s}),i=r}else{let e="",s=i+1;for(;s<t.length;){const n=t.substr(s,1);if(!(s===i+1&&F.test(n)||s!==i+1&&B.test(n)))break;e+=t[s++]}if(!e){a(`Missing parameter name at ${i}`);continue}n.push({type:"NAME",index:i,value:e}),i=s}else n.push({type:"CLOSE",index:i,value:t[i++]});else n.push({type:"OPEN",index:i,value:t[i++]});else n.push({type:"ESCAPED_CHAR",index:i++,value:t[i++]});else n.push({type:"MODIFIER",index:i,value:t[i++]});else n.push({type:"ASTERISK",index:i,value:t[i++]})}return n.push({type:"END",index:i,value:""}),n}function W(t,e={}){const n=Q(t),{prefixes:i="./"}=e,s=`[^${G(void 0===e.delimiter?"/#?":e.delimiter)}]+?`,a=[];let r=0,o=0,h="",l=new Set;const c=t=>{if(o<n.length&&n[o].type===t)return n[o++].value},u=()=>{const t=c("MODIFIER");return t||c("ASTERISK")},p=t=>{const e=c(t);if(void 0!==e)return e;const{type:i,index:s}=n[o];throw new TypeError(`Unexpected ${i} at ${s}, expected ${t}`)},d=()=>{let t,e="";for(;t=c("CHAR")||c("ESCAPED_CHAR");)e+=t;return e},m=e.encodePart||(t=>t);for(;o<n.length;){const t=c("CHAR"),e=c("NAME");let n=c("PATTERN");if(e||n||!c("ASTERISK")||(n=".*"),e||n){let o=t||"";-1===i.indexOf(o)&&(h+=o,o=""),h&&(a.push(m(h)),h="");const c=e||r++;if(l.has(c))throw new TypeError(`Duplicate name '${c}'.`);l.add(c),a.push({name:c,prefix:m(o),suffix:"",pattern:n||s,modifier:u()||""});continue}const o=t||c("ESCAPED_CHAR");if(o){h+=o;continue}if(c("OPEN")){const t=d(),e=c("NAME")||"";let n=c("PATTERN")||"";e||n||!c("ASTERISK")||(n=".*");const i=d();p("CLOSE");const o=u()||"";if(!e&&!n&&!o){h+=t;continue}if(!e&&!n&&!t)continue;h&&(a.push(m(h)),h=""),a.push({name:e||(n?r++:""),pattern:e&&!n?s:n,prefix:m(t),suffix:m(i),modifier:o})}else h&&(a.push(m(h)),h=""),p("END")}return a}function G(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function K(t){return t&&t.ignoreCase?"ui":"u"}function V(t,e,n={}){const{strict:i=!1,start:s=!0,end:a=!0,encode:r=(t=>t)}=n,o=`[${G(void 0===n.endsWith?"":n.endsWith)}]|$`,h=`[${G(void 0===n.delimiter?"/#?":n.delimiter)}]`;let l=s?"^":"";for(const n of t)if("string"==typeof n)l+=G(r(n));else{const t=G(r(n.prefix)),i=G(r(n.suffix));if(n.pattern)if(e&&e.push(n),t||i)if("+"===n.modifier||"*"===n.modifier){const e="*"===n.modifier?"?":"";l+=`(?:${t}((?:${n.pattern})(?:${i}${t}(?:${n.pattern}))*)${i})${e}`}else l+=`(?:${t}(${n.pattern})${i})${n.modifier}`;else"+"===n.modifier||"*"===n.modifier?l+=`((?:${n.pattern})${n.modifier})`:l+=`(${n.pattern})${n.modifier}`;else l+=`(?:${t}${i})${n.modifier}`}if(a)i||(l+=`${h}?`),l+=n.endsWith?`(?=${o})`:"$";else{const e=t[t.length-1],n="string"==typeof e?h.indexOf(e[e.length-1])>-1:void 0===e;i||(l+=`(?:${h}(?=${o}))?`),n||(l+=`(?=${h}|${o})`)}return new RegExp(l,K(n))}function J(t,e,n){return t instanceof RegExp?function(t,e){if(!e)return t;const n=/\((?:\?<(.*?)>)?(?!\?)/g;let i=0,s=n.exec(t.source);for(;s;)e.push({name:s[1]||i++,prefix:"",suffix:"",modifier:"",pattern:""}),s=n.exec(t.source);return t}(t,e):Array.isArray(t)?function(t,e,n){const i=t.map((t=>J(t,e,n).source));return new RegExp(`(?:${i.join("|")})`,K(n))}(t,e,n):function(t,e,n){return V(W(t,n),e,n)}(t,e,n)}var X={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Y={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Z={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function tt(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function et(t){return!(!t||t.length<2)&&("["===t[0]||("\\"===t[0]||"{"===t[0])&&"["===t[1])}var nt=["ftp","file","http","https","ws","wss"];function it(t){if(!t)return!0;for(const e of nt)if(t.test(e))return!0;return!1}function st(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function at(t){if(""===t)return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function rt(t){if(""===t)return t;const e=new URL("https://example.com");return e.username=t,e.username}function ot(t){if(""===t)return t;const e=new URL("https://example.com");return e.password=t,e.password}function ht(t){if(""===t)return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);const e=new URL("https://example.com");return e.hostname=t,e.hostname}function lt(t){if(""===t)return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function ct(t){if(""===t)return t;if(/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function ut(t){if(""===t)return t;const e=new URL("https://example.com");return e.pathname="/"!==t[0]?"/-"+t:t,"/"!==t[0]?e.pathname.substring(2,e.pathname.length):e.pathname}function pt(t){if(""===t)return t;return new URL(`data:${t}`).pathname}function dt(t){if(""===t)return t;const e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function mt(t){if(""===t)return t;const e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}var ft=["protocol","username","password","hostname","port","pathname","search","hash"];function gt(t,e){if("string"!=typeof t)throw new TypeError("parameter 1 is not of type 'string'.");const n=new URL(t,e);return{protocol:n.protocol.substring(0,n.protocol.length-1),username:n.username,password:n.password,hostname:n.hostname,port:n.port,pathname:n.pathname,search:""!=n.search?n.search.substring(1,n.search.length):void 0,hash:""!=n.hash?n.hash.substring(1,n.hash.length):void 0}}function Ct(t,e){return e?vt(t):t}function bt(t,e,n){let i;if("string"==typeof e.baseURL)try{i=new URL(e.baseURL),t.protocol=Ct(i.protocol.substring(0,i.protocol.length-1),n),t.username=Ct(i.username,n),t.password=Ct(i.password,n),t.hostname=Ct(i.hostname,n),t.port=Ct(i.port,n),t.pathname=Ct(i.pathname,n),t.search=Ct(i.search.substring(1,i.search.length),n),t.hash=Ct(i.hash.substring(1,i.hash.length),n)}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if("string"==typeof e.protocol&&(t.protocol=function(t,e){var n,i;return i=":",t=(n=t).endsWith(i)?n.substr(0,n.length-i.length):n,e||""===t?t:at(t)}(e.protocol,n)),"string"==typeof e.username&&(t.username=function(t,e){if(e||""===t)return t;const n=new URL("https://example.com");return n.username=t,n.username}(e.username,n)),"string"==typeof e.password&&(t.password=function(t,e){if(e||""===t)return t;const n=new URL("https://example.com");return n.password=t,n.password}(e.password,n)),"string"==typeof e.hostname&&(t.hostname=function(t,e){return e||""===t?t:et(t)?lt(t):ht(t)}(e.hostname,n)),"string"==typeof e.port&&(t.port=function(t,e,n){return st(e)===t&&(t=""),n||""===t?t:ct(t)}(e.port,t.protocol,n)),"string"==typeof e.pathname){if(t.pathname=e.pathname,i&&!function(t,e){return!(!t.length||"/"!==t[0]&&(!e||t.length<2||"\\"!=t[0]&&"{"!=t[0]||"/"!=t[1]))}(t.pathname,n)){const e=i.pathname.lastIndexOf("/");e>=0&&(t.pathname=Ct(i.pathname.substring(0,e+1),n)+t.pathname)}t.pathname=function(t,e,n){if(n||""===t)return t;if(e&&!nt.includes(e))return new URL(`${e}:${t}`).pathname;const i="/"==t[0];return t=new URL(i?t:"/-"+t,"https://example.com").pathname,i||(t=t.substring(2,t.length)),t}(t.pathname,t.protocol,n)}return"string"==typeof e.search&&(t.search=function(t,e){if(t=tt(t,"?"),e||""===t)return t;const n=new URL("https://example.com");return n.search=t,n.search?n.search.substring(1,n.search.length):""}(e.search,n)),"string"==typeof e.hash&&(t.hash=function(t,e){if(t=tt(t,"#"),e||""===t)return t;const n=new URL("https://example.com");return n.hash=t,n.hash?n.hash.substring(1,n.hash.length):""}(e.hash,n)),t}function vt(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function St(t,e){const n=`[^${i=void 0===e.delimiter?"/#?":e.delimiter,i.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}]+?`;var i;const s=/[$_\u200C\u200D\p{ID_Continue}]/u;let a="";for(let i=0;i<t.length;++i){const r=t[i],o=i>0?t[i-1]:null,h=i<t.length-1?t[i+1]:null;if("string"==typeof r){a+=vt(r);continue}if(""===r.pattern){if(""===r.modifier){a+=vt(r.prefix);continue}a+=`{${vt(r.prefix)}}${r.modifier}`;continue}const l="number"!=typeof r.name,c=void 0!==e.prefixes?e.prefixes:"./";let u=""!==r.suffix||""!==r.prefix&&(1!==r.prefix.length||!c.includes(r.prefix));if(!u&&l&&r.pattern===n&&""===r.modifier&&h&&!h.prefix&&!h.suffix)if("string"==typeof h){const t=h.length>0?h[0]:"";u=s.test(t)}else u="number"==typeof h.name;if(!u&&""===r.prefix&&o&&"string"==typeof o&&o.length>0){const t=o[o.length-1];u=c.includes(t)}u&&(a+="{"),a+=vt(r.prefix),l&&(a+=`:${r.name}`),".*"===r.pattern?l||o&&"string"!=typeof o&&!o.modifier&&!u&&""===r.prefix?a+="(.*)":a+="*":r.pattern===n?l||(a+=`(${n})`):a+=`(${r.pattern})`,r.pattern===n&&l&&""!==r.suffix&&s.test(r.suffix[0])&&(a+="\\"),a+=vt(r.suffix),u&&(a+="}"),a+=r.modifier}return a}globalThis.URLPattern||(globalThis.URLPattern=class{constructor(t={},e,n){this.regexp={},this.keys={},this.component_pattern={};try{let i;if("string"==typeof e?i=e:n=e,"string"==typeof t){const e=new class{constructor(t){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}get result(){return this.internalResult}parse(){for(this.tokenList=Q(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,"END"===this.tokenList[this.tokenIndex].type){if(0===this.state){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}if(2===this.state){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let t=7,e=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=2,e=3):this.shouldTreatAsStandardURL&&(t=2),this.changeState(t,e)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1)}}}changeState(t,e){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(t,e)}changeStateWithoutSettingComponent(t,e){this.state=t,this.componentStart=this.tokenIndex+e,this.tokenIndex+=e,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(t){this.rewind(),this.state=t}safeToken(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(t,e){const n=this.safeToken(t);return n.value===e&&("CHAR"===n.type||"ESCAPED_CHAR"===n.type||"INVALID_CHAR"===n.type)}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if("?"!==this.tokenList[this.tokenIndex].value)return!1;const t=this.safeToken(this.tokenIndex-1);return"NAME"!==t.type&&"PATTERN"!==t.type&&"CLOSE"!==t.type&&"ASTERISK"!==t.type}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return"OPEN"==this.tokenList[this.tokenIndex].type}isGroupClose(){return"CLOSE"==this.tokenList[this.tokenIndex].type}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){const t=this.tokenList[this.tokenIndex],e=this.safeToken(this.componentStart).index;return this.input.substring(e,t.index)}computeShouldTreatAsStandardURL(){const t={};Object.assign(t,X),t.encodePart=at;const e=J(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=it(e)}}(t);if(e.parse(),t=e.result,void 0===i&&"string"!=typeof t.protocol)throw new TypeError("A base URL must be provided for a relative constructor string.");t.baseURL=i}else{if(!t||"object"!=typeof t)throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");if(i)throw new TypeError("parameter 1 is not of type 'string'.")}void 0===n&&(n={ignoreCase:!1});const s={ignoreCase:!0===n.ignoreCase},a={pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"};let r;for(r of(this.pattern=bt(a,t,!0),st(this.pattern.protocol)===this.pattern.port&&(this.pattern.port=""),ft)){if(!(r in this.pattern))continue;const t={},e=this.pattern[r];switch(this.keys[r]=[],r){case"protocol":Object.assign(t,X),t.encodePart=at;break;case"username":Object.assign(t,X),t.encodePart=rt;break;case"password":Object.assign(t,X),t.encodePart=ot;break;case"hostname":Object.assign(t,Y),et(e)?t.encodePart=lt:t.encodePart=ht;break;case"port":Object.assign(t,X),t.encodePart=ct;break;case"pathname":it(this.regexp.protocol)?(Object.assign(t,Z,s),t.encodePart=ut):(Object.assign(t,X,s),t.encodePart=pt);break;case"search":Object.assign(t,X,s),t.encodePart=dt;break;case"hash":Object.assign(t,X,s),t.encodePart=mt}try{const n=W(e,t);this.regexp[r]=V(n,this.keys[r],t),this.component_pattern[r]=St(n,t)}catch{throw new TypeError(`invalid ${r} pattern '${this.pattern[r]}'.`)}}}catch(t){throw new TypeError(`Failed to construct 'URLPattern': ${t.message}`)}}test(t={},e){let n,i={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if("string"!=typeof t&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(void 0===t)return!1;try{i=bt(i,"object"==typeof t?t:gt(t,e),!1)}catch(t){return!1}for(n of ft)if(!this.regexp[n].exec(i[n]))return!1;return!0}exec(t={},e){let n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if("string"!=typeof t&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(void 0===t)return;try{n=bt(n,"object"==typeof t?t:gt(t,e),!1)}catch(t){return null}let i,s={};for(i of(s.inputs=e?[t,e]:[t],ft)){let t=this.regexp[i].exec(n[i]);if(!t)return null;let e={};for(let[n,s]of this.keys[i].entries())if("string"==typeof s.name||"number"==typeof s.name){let i=t[n+1];e[s.name]=i}s[i]={input:n[i]||"",groups:e}}return s}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}});const xt=async(...t)=>{const n=await e(...t);return n.errors&&0===n.errors.length&&(n.errors=void 0),n};class yt{constructor(){this.queryContentControlSettings=(e,n)=>xt({operation:t.ChatContentControlSettings,variables:e,init:{signal:n?.abortController?.signal}}),this.queryRedditors=(e,n)=>xt({operation:t.ChatRedditors,variables:e,init:{signal:n?.abortController?.signal}}),this.queryRedditorsByName=(e,n)=>xt({operation:t.ChatRedditorsByName,variables:e,init:{signal:n?.abortController?.signal}}),this.queryBannedUsers=e=>xt({operation:t.ChatBannedUsers,variables:e}),this.searchChatMessageReactionIcons=(e,n)=>xt({operation:t.ChatSearchChatMessageReactionIcons,variables:e,init:{signal:n?.abortController?.signal}}),this.queryCrowdControlSettings=(e,n)=>xt({operation:t.ChatCrowdControlSettings,variables:e,init:{signal:n?.abortController?.signal}}),this.getUccChannelTaggingInfo=(e,n)=>xt({operation:t.ChatGetUccChannelTaggingInfo,variables:e,init:{signal:n?.abortController?.signal}}),this.queryTagSubreddits=(e,n)=>xt({operation:t.ChatQueryTagSubreddits,variables:e,init:{signal:n?.abortController?.signal}}),this.getChatChannelBannedUsers=(e,n)=>xt({operation:t.ChatGetChatChannelBannedUsers,variables:e,init:{signal:n?.abortController?.signal}}),this.querySubreddit=(e,n)=>xt({operation:t.ChatSubreddit,variables:e,init:{signal:n?.abortController?.signal}}),this.queryBlockedRedditors=(e,n)=>xt({operation:t.ChatBlockedRedditors,variables:e,init:{signal:n?.abortController?.signal}}),this.queryChatUnitDetails=(e,n)=>xt({operation:t.ChatUnitDetails,variables:e,init:{signal:n?.abortController?.signal}}),this.queryReportForm=(e,n)=>xt({operation:t.ChatReportForm,variables:e,init:{signal:n?.abortController?.signal}}),this.queryIsUserBannedFromChatChannel=(e,n)=>xt({operation:t.ChatIsUserBannedFromChatChannel,variables:e,init:{signal:n?.abortController?.signal}}),this.banChatChannelUser=(e,n)=>xt({operation:t.ChatBanChatChannelUser,variables:e,init:{signal:n?.abortController?.signal}}),this.createUccChatChannel=(e,n)=>xt({operation:t.ChatCreateUccChatChannel,variables:e,init:{signal:n?.abortController?.signal}}),this.updateChannel=(e,n)=>xt({operation:t.ChatUpdateChannel,variables:e,init:{signal:n?.abortController?.signal}}),this.updateChannelModerationSettings=(e,n)=>xt({operation:t.ChatUpdateChannelModerationSettings,variables:e,init:{signal:n?.abortController?.signal}}),this.banSubredditUser=(e,n)=>xt({operation:t.ChatBanSubredditUser,variables:e,init:{signal:n?.abortController?.signal}}),this.unbanSubredditUser=(e,n)=>xt({operation:t.ChatUnbanSubredditUser,variables:e,init:{signal:n?.abortController?.signal}}),this.updateCrowdControlLevel=(e,n)=>xt({operation:t.ChatUpdateCrowdControlLevel,variables:e,init:{signal:n?.abortController?.signal}}),this.pinMessagesToSubredditChannel=(e,n)=>xt({operation:t.ChatPinMessagesToSubredditChannel,variables:e,init:{signal:n?.abortController?.signal}}),this.updateChatChannelUsersRoles=(e,n)=>xt({operation:t.ChatUpdateChatChannelUsersRoles,variables:e,init:{signal:n?.abortController?.signal}}),this.retractChatChannelUserRoleInvitation=(e,n)=>xt({operation:t.ChatRetractChatChannelUserRoleInvitation,variables:e,init:{signal:n?.abortController?.signal}}),this.updateChatChannelUserRolePromotion=(e,n)=>xt({operation:t.ChatUpdateChatChannelUserRolePromotion,variables:e,init:{signal:n?.abortController?.signal}}),this.unbanChatChannelUser=(e,n)=>xt({operation:t.ChatUnbanChatChannelUser,variables:e,init:{signal:n?.abortController?.signal}}),this.createShareUrl=(e,n)=>xt({operation:t.ChatCreateShareUrl,variables:e,init:{signal:n?.abortController?.signal}}),this.createSubredditChannel=(e,n)=>xt({operation:t.ChatCreateSubredditChannel,variables:e,init:{signal:n?.abortController?.signal}}),this.updateAccountPreferences=(e,n)=>xt({operation:t.ChatUpdateAccountPreferences,variables:e,init:{signal:n?.abortController?.signal}}),this.updateRedditorBlockState=(e,n)=>xt({operation:t.ChatUpdateRedditorBlockState,variables:e,init:{signal:n?.abortController?.signal}}),this.deleteChannel=(e,n)=>xt({operation:t.ChatDeleteChannel,variables:e,init:{signal:n?.abortController?.signal}}),this.approveMod=(e,n)=>xt({operation:t.ChatModApprove,variables:e,init:{signal:n?.abortController?.signal}}),this.removeMod=(e,n)=>xt({operation:t.ChatModRemove,variables:e,init:{signal:n?.abortController?.signal}})}}let wt=class extends k{connectedCallback(){super.connectedCallback(),this.client??(this.client=new yt),window.customElements.whenDefined("rs-app").then((()=>{if(!this.client)return;this.getRootNode().querySelector("rs-app")?.setGqlClientContext(this.client)}))}};wt=n([i("reddit-chat-gql-client")],wt);let kt=class extends M{static get styles(){return T``}};kt=n([i("reddit-chat-toaster")],kt);let Tt=class extends q{constructor(){super();const t=this.show;this.show=e=>{t(e),this._menu.style.transform="translate(13px, -10px)"}}};var It;Tt=n([i("chat-toast-menu")],Tt),function(t){t.direct="direct",t.community="community",t.private_group="private_group",t.public_group="public_group",t.reddit_ucc="reddit_ucc"}(It||(It={}));const Rt=t=>t.stopPropagation(),$t=({channelIconUrl:t,userAvatarUrl:e,roomType:n})=>{const i=n===It.reddit_ucc||n===It.community,s=e?R`<div \n class="${r({"bg-secondary-background rounded-full flex items-center justify-center overflow-hidden":!0,"mr-sm w-[40px] h-[40px] min-w-[40px] self-center":!i,"absolute right-0 bottom-0 w-lg h-lg":i})}" \n>\n <img \n class="${r({"w-[40px] h-[40px]":!i,"w-[20px] h-[20px]":i})}" \n src="${e}" \n alt="chat toast user avatar" \n>\n </div>`:I;return i?R`<div \n class="relative basis-[fit-content] mr-sm w-[40px] h-[40px] min-w-[40px] max-w-[40px] self-center" \n>\n ${t?R`<img \n class="w-100 h-100 rounded-full" \n src="${t}" \n alt="chat toast channel icon" \n>`:(a=n,a===It.reddit_ucc?R`<div \n class="flex items-center justify-center w-[40px] h-[40px] rounded-full bg-secondary-background" \n>\n ${P({attributes:{className:"flex items-center justify-center bg-transparent fill-primary-background","aria-hidden":"true"}})}\n </div>`:E({attributes:{className:"flex justify-center items-center rounded-full w-full h-full bg-white text-global-alienblue box-border border-solid border-white border-[0.1rem]","aria-hidden":"true"}}))}\n ${s}\n </div>`:s;var a},At=({notification:t,onClick:e,onClickNotificationSettings:n,onPauseNotifications:i,onRenderToast:r,onOpenToastMenu:o,onCloseToastMenu:h})=>{const{senderId:l,senderName:c,roomId:u,roomName:p,eventId:d,message:m,pauseNotifications:f}=t||{};if(!u||!d)return I;r();const g=R`<span class="font-bold">${c||l}</span>`,C=R`<span class="font-bold">${p}</span>`,b=p?R`${g} in ${C}`:g;return R`\n <div \n class="toast absolute w-[351px] bottom-0 right-0 bg-neutral-background p-sm flex rounded-[8px] mt-md text-tone-1 cursor-pointer shadow-sm hover:bg-neutral-background-hover" \n @click="${e}" \n @keydown="${e}" \n data-testid="chat-toast" \n>\n ${$t(t)}\n <div class="flex flex-col">\n <span class="line-clamp-1" data-testid="chat-toast-title">${b}</span>\n <span class="line-clamp-2" data-testid="chat-toast-message">${m}</span>\n </div>\n <div class="ml-auto" @click="${Rt}" @keydown="${Rt}">\n ${(t=>{const{handlePauseNotifications:e,onClickNotificationSettings:n,onOpenToastMenu:i,onCloseToastMenu:r}=t;return R`<chat-toast-menu \n position="top" \n .onopen="${i}" \n .onclose="${r}" \n>\n ${s({appearance:"plain",size:a.ExtraSmall,attributes:{className:"overflow-visible !px-0 w-lg h-lg"},screenReaderContent:"Chat notifications toast options menu",children:$({size:A.ExtraSmall})})}\n <faceplate-menu slot="menu" class="w-[220px]">\n ${_({label:R`<span class="text-tone-1">\n Pause for 1 hour\n </span>`,onClick:()=>e(1)})}\n ${_({label:R`<span class="text-tone-1">\n Pause for 6 hours\n </span>`,onClick:()=>e(6)})}\n ${_({label:R`<span class="text-tone-1">\n Pause for 24 hours\n </span>`,onClick:()=>e(24)})}\n ${_({label:R`<span class="text-tone-1">\n Notification settings\n </span>`,onClick:n})}\n </faceplate-menu>\n </chat-toast-menu>`})({handlePauseNotifications:t=>{i(u),f(t)},onClickNotificationSettings:n,onOpenToastMenu:o,onCloseToastMenu:h})}\n </div>\n </div>\n `};var Pt;class Et{constructor(t,e){Pt.set(this,!1),this.remaining=e,this.callback=t,this.timerId=void 0,this.start=void 0,this.resume()}get isPaused(){return o(this,Pt,"f")}pause(){this.timerId&&this.start&&(this.clear(),this.remaining=this.remaining-(Date.now()-this.start),h(this,Pt,!0,"f"))}resume(){this.timerId||(this.start=Date.now(),this.timerId=window.setTimeout(this.callback,this.remaining),h(this,Pt,!1,"f"))}clear(){this.timerId&&(window.clearTimeout(this.timerId),this.timerId=void 0)}}Pt=new WeakMap;const Lt=t=>"/"===t[t.length-1]?t:`${t}/`;let Ut=class extends(l(c(k))){constructor(){super(...arguments),this.country="",this.isAlwaysOn=!1,this.preload=!1,this.denyList=[],this.uiState="closed",this.notificationCount=0,this.currentToast=null,this._locationImpl=window.location,this.toastsQueue=[],this.toastAutoDismissTimer=void 0,this.pushToastsFromQueueInterval=void 0,this.isEventListenersSet=!1,this.updateUIState=t=>{if(!this.isAlwaysOn)return;const e=((t,e)=>{if(0===e.length)return!1;const n=Lt(t);return e.some((t=>0===n.indexOf(Lt(t))))})(t,this.denyList);if(this.inDeniedPath!==e)if(this.inDeniedPath=e,this.inDeniedPath)this.setUIState("closed");else{const t=u.get(p)??"minimized",e="closed"===t?"minimized":t;this.setUIState(e)}},this.initialized=!1,this.handleFaceplateAlert=t=>{t.stopPropagation()},this.handleNavigate=t=>{const e=new URL(t.destination.url);this.updateUIState(e.pathname)},this.hasChatClientActivated=!1,this.onChatClientClose=()=>{this.setUIState("closed")},this.onChatClientMaximize=()=>{this.setUIState("maximized"),this.dismissToast(),this.clearToastsFromQueue(),this.triggerChatTimelineScroll()},this.triggerChatTimelineScroll=()=>{this.getShadowRoot().querySelector("rs-app")?.shadowRoot?.querySelector("rs-room")?.shadowRoot?.querySelector("rs-timeline")?.shadowRoot?.querySelector("rs-virtual-scroll-dynamic")?.dispatchEvent(new CustomEvent("scroll"))},this.clearToastsFromQueue=t=>{this.toastsQueue=t?this.toastsQueue.filter((e=>e.roomId!==t)):[]},this.onChatClientMinimize=()=>{this.setUIState("minimized")},this.removeChatAppEventListeners=null,this.onChatOpenImageModal=t=>{if(!this.canUseLightbox())return;t.preventDefault();const{url:e}=t.detail,n=document.createElement("div"),i=document.createElement("div"),s=document.createElement("img");s.src=e,s.setAttribute("role","presentation"),s.setAttribute("fetchPriority","auto"),s.setAttribute("loading","lazy");const a=document.createElement("img");a.src=e,a.alt="Chat image",a.setAttribute("fetchPriority","auto"),a.setAttribute("loading","lazy"),i.className="h-full w-full object-contain overflow-hidden relative bg-black",s.className="absolute top-1/2 -translate-y-1/2 left-0 w-full opacity-30 object-cover scale-[1.2] post-background-image-filter",a.className="h-full w-full object-contain relative",i.appendChild(s),i.appendChild(a),n.appendChild(i);const r=new URL(location.href);r.hash="chat-image";const o=r.href.replace(r.origin,"");d(m.LightboxOpen,{element:n,attributes:{permalink:o}})},this.onChatAppStateChange=t=>{switch(t.detail){case"minimize":this.onChatClientMinimize();break;case"maximize":this.onChatClientMaximize();break;case"close":this.onChatClientClose()}},this.onChatNotificationsCountChange=t=>{this.notificationCount=t.detail,this.getShadowRoot().querySelector("dynamic-badge")?.setCount(this.notificationCount),this.updateNotificationCountInTheHeader(this.notificationCount)},this.onChatMultitaskingNotification=t=>{"maximized"!==this.uiState&&f()!==g.PostCreation&&this.toastsQueue.push(t.detail)},this.pushToastsFromQueue=()=>{if(this.toastAutoDismissTimer?.isPaused)return;const t=this.toastsQueue.shift();if(!t)return;const e=t.eventId;this.resetToastAutoDismissTimer(),this.currentToast=t,this.autoDismissToast(e)},this.onChatLocationChange=t=>{const e=t.detail,n=new URL(e.location.href);let i=n.href.replace(n.origin,"");i.startsWith("/")||(i="/"+i),this.setLatestPathCookie(i),this.updateChatClientTemplate(i)},this.onChatSccCreated=t=>{const e=t.detail.subredditName;if(!e)return;if(this._locationImpl.pathname===`/mod/${e}/chat-channels/channels`)return void this._locationImpl.reload();this._locationImpl.pathname===`/r/${e}/`&&document.querySelector(`faceplate-partial#${j}`)?.load()},this.onChatToastClick=()=>{if(!this.currentToast)return;const{eventId:t,roomId:e,chatTelemetry:n}=this.currentToast;this.trackEvent(C({source:O.Chat,action:b.Click,noun:z.InAppToast},{chat:n})),this.dismissToast(),this.clearToastsFromQueue(),this.openChatUrl(`/room/${e}/event/${t}`)},this.onClickNotificationSettings=()=>{const t=this.currentToast?.roomId;t&&(this.openChatUrl(`/room/${t}/settings/manage-notifications`),this.dismissToast(),this.clearToastsFromQueue())},this.onPauseNotifications=t=>{this.dismissToast(),this.clearToastsFromQueue(t)},this.onRenderToast=()=>{if(!this.currentToast)return;const{chatTelemetry:t}=this.currentToast;this.trackEvent(C({source:O.Chat,action:b.View,noun:z.InAppToast},{chat:t}))},this.onOpenToastMenu=()=>{if(!this.currentToast)return;const{chatTelemetry:t}=this.currentToast;this.toastAutoDismissTimer?.pause(),this.trackEvent(C({source:O.Chat,action:b.View,noun:z.InAppToastActionSheet},{chat:t}))},this.onCloseToastMenu=()=>{this.toastAutoDismissTimer?.resume()},this.renderedTemplate=null}_setLocationImpl(t){this._locationImpl=t}init(){this.initialized||(this.initialized=!0,this.updateUIState(window.location.pathname))}getShadowRoot(){return this.portalShadowRoot}getContainer(){return this.portalContainer}connectedCallback(){super.connectedCallback(),this.setChatAppEventListeners(),this.pushToastsFromQueueInterval=setInterval((()=>{this.pushToastsFromQueue()}),2e3),window.navigation?.addEventListener("navigate",this.handleNavigate),this.getContainer().addEventListener("faceplate-alert",this.handleFaceplateAlert),this.init()}disconnectedCallback(){super.disconnectedCallback(),this.removeChatAppEventListeners?.(),clearInterval(this.pushToastsFromQueueInterval),this.pushToastsFromQueueInterval=void 0,this.getContainer().removeEventListener("faceplate-alert",this.handleFaceplateAlert),window.navigation?.removeEventListener("navigate",this.handleNavigate)}setUIStateCookie(){v({country:this.country,name:p,value:this.uiState})}setLatestPathCookie(t){v({country:this.country,name:S,value:t??"/"})}willUpdate(t){super.willUpdate(t);const e=t.has("uiState"),n=t.get("uiState");if(e&&void 0!==n){const t=this.getShadowRoot().querySelector("rs-app");"maximized"===this.uiState?t?.removeAttribute("background"):t?.setAttribute("background","true")}}handleUIStateChangeWhenPreloading(){this.hasChatClientActivated||(this.attachPortal(),this.setChatAppEventListeners(),this.hasChatClientActivated=!0)}handleUIStateChange(t){if(t&&"closed"!==t||"minimized"!==this.uiState&&"maximized"!==this.uiState){if(("minimized"===t||"maximized"===t)&&"closed"===this.uiState){this.getShadowRoot().querySelector("rs-matrix-client")?.pauseSync({blockRestart:!0,force:!0}),this.removeChatAppEventListeners?.(),this.removePortal()}}else{this.attachPortal();const t=this.getShadowRoot().querySelector("rs-matrix-client");this.hasChatClientActivated&&t?.startSync({unblockRestart:!0}),this.setChatAppEventListeners()}this.hasChatClientActivated||(this.hasChatClientActivated="closed"!==this.uiState)}updated(t){const e=t.get("uiState");e!==this.uiState&&(this.setUIStateCookie(),this.isAlwaysOn||this.preload?this.handleUIStateChangeWhenPreloading():this.handleUIStateChange(e))}openChatUrl(t){if("closed"!==this.uiState||this.hasChatClientActivated){this.getShadowRoot().querySelector("rs-history").navigate(t)}else{this.querySelector("template").content.querySelector("rs-history")?.setAttribute("initial-path",t)}this.onChatClientMaximize()}setChatAppEventListeners(){const t=this.getShadowRoot().querySelector("rs-app");t&&(this.isEventListenersSet||(t.addEventListener("change-chat-app-state",this.onChatAppStateChange),t.addEventListener("change-chat-notifications-count",this.onChatNotificationsCountChange),t.addEventListener("multitask-notification",this.onChatMultitaskingNotification),t.addEventListener("open-image-modal",this.onChatOpenImageModal),t.addEventListener("location-change",this.onChatLocationChange),t.addEventListener("scc-created",this.onChatSccCreated),this.removeChatAppEventListeners=()=>{t.removeEventListener("change-chat-app-state",this.onChatAppStateChange),t.removeEventListener("change-chat-notifications-count",this.onChatNotificationsCountChange),t.removeEventListener("multitask-notification",this.onChatMultitaskingNotification),t.removeEventListener("open-image-modal",this.onChatOpenImageModal),t.removeEventListener("location-change",this.onChatLocationChange),t.removeEventListener("scc-created",this.onChatSccCreated),this.isEventListenersSet=!1},this.isEventListenersSet=!0))}canUseLightbox(){return!!document.querySelector("shreddit-media-lightbox")}updateChatClientTemplate(t){this.querySelector("template").content.querySelector("rs-history")?.setAttribute("initial-path",t)}updateNotificationCountInTheHeader(t){const e=document.getElementById("header-action-item-chat-button-badge");e&&e.setCount(t)}setUIState(t){this.uiState=t}toggleUIState(){if("maximized"===this.uiState){if(this.isAlwaysOn)return this.onChatClientMinimize();this.onChatClientClose()}else this.onChatClientMaximize()}resetToastAutoDismissTimer(){this.toastAutoDismissTimer?.clear(),this.toastAutoDismissTimer=void 0}dismissToast(){this.currentToast=null,this.resetToastAutoDismissTimer()}autoDismissToast(t,e=5e3){this.toastAutoDismissTimer=new Et((()=>{this.currentToast?.eventId!==t||this.toastAutoDismissTimer?.isPaused||this.dismissToast()}),e)}renderChatClientTemplate(){if(!this.renderedTemplate){const t=this.querySelector("template");if("maximized"!==this.uiState){t.content.querySelector("rs-app").setAttribute("background","true")}const e=t.content.cloneNode(!0);this.renderedTemplate=R`${e}`}return this.renderedTemplate}renderMinimizedChatClient(){return R`\n <div \n class="relative group w-[130px] min-w-[130px] ${r({"w-[256px] min-w-[256px] h-[44px]":this.isAlwaysOn})}" \n data-testid="minimized-chat-pill" \n>\n <button \n class="bg-transparent cursor-pointer border-none flex items-center py-sm pl-md pr-2xl w-100 h-100" \n aria-label="Maximize chat view" \n @click="${this.onChatClientMaximize}" \n>\n ${this.isAlwaysOn?L({size:A.Medium}):null}\n <p \n class="m-0 text-14 leading-4 font-sans ${r({"font-bold ml-2xs":this.isAlwaysOn})}" \n>\n Chat\n </p>\n <dynamic-badge \n class="ml-xs" \n initial-count="${this.notificationCount}" \n appearance="${D.ALERT}" \n></dynamic-badge>\n </button>\n ${this.isAlwaysOn&&!this.inDeniedPath?s({appearance:"plain",attributes:{className:"absolute right-xs top-1/2 -translate-y-1/2",onclick:this.onChatClientMaximize,type:"button","data-testid":"chat-expand-button"},leadingIcon:U({size:A.Small}),size:a.Small,screenReaderContent:"Expand chat"}):s({appearance:"plain",attributes:{className:"absolute right-xs top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 focus:opacity-100",onclick:this.onChatClientClose,type:"button","data-testid":"chat-close-button"},leadingIcon:N({size:A.ExtraSmall}),size:a.ExtraSmall,screenReaderContent:"Close chat"})}\n </div>\n `}renderToasts(){return this.currentToast?R`<div class="absolute bottom-2xl right-0">\n ${At({notification:this.currentToast,onClick:this.onChatToastClick,onClickNotificationSettings:this.onClickNotificationSettings,onPauseNotifications:this.onPauseNotifications,onRenderToast:this.onRenderToast,onOpenToastMenu:this.onOpenToastMenu,onCloseToastMenu:this.onCloseToastMenu})}\n </div>`:null}render(){return"closed"!==this.uiState||this.hasChatClientActivated||this.isAlwaysOn||this.preload?R`\n ${this.renderToasts()}\n <div \n class="${"closed"===this.uiState?"hidden":"rounded-t-[16px] border-sm border-solid border-neutral-border-weak border-b-0 shadow-md overflow-hidden bg-neutral-background"}" \n data-testid="reddit-chat-client" \n>\n <div class="${"maximized"!==this.uiState?"hidden":""}">\n <faceplate-alert-reporter class="!relative">\n ${this.renderChatClientTemplate()}\n ${"maximized"===this.uiState?R`\n <reddit-chat-toaster \n class="absolute bottom-sm left-1/2 -translate-x-1/2 flex flex-col gap-xs" \n></reddit-chat-toaster>\n `:I}\n </faceplate-alert-reporter>\n </div>\n ${"minimized"===this.uiState?this.renderMinimizedChatClient():""}\n </div>\n `:R``}};Ut.styles=[x,T`:host{position:fixed;bottom:0;right:var(--spacer-xl)}`,T`@keyframes fadeinout{0%{opacity:0}100%{opacity:1}}.toast{animation:fadeinout .1s linear forwards}`],n([y({type:String})],Ut.prototype,"country",void 0),n([y({type:Boolean,attribute:"is-always-on"})],Ut.prototype,"isAlwaysOn",void 0),n([y({type:Boolean,attribute:"preload"})],Ut.prototype,"preload",void 0),n([y({type:Array,converter:t=>t?t.split(","):[],attribute:"deny-list"})],Ut.prototype,"denyList",void 0),n([w()],Ut.prototype,"uiState",void 0),n([w()],Ut.prototype,"notificationCount",void 0),n([w()],Ut.prototype,"currentToast",void 0),Ut=n([i("reddit-chat-host")],Ut),import("./matrix-js-sdk-29ee1345.js").then((()=>import("./dist-ef790a9b.js")));
//# sourceMappingURL=reddit-chat-client-js-ed1902e6.js.map
