import{l as e,dM as t,W as a,a as n,_ as i,n as s,t as o,b1 as l,k as r,b6 as c,b as u,c as m,e as d}from"./shell-ceb66a5c.js";import{aq as p,ar as h,ac as f,as as b,ah as y,at as v,au as g,av as _,i as w,s as x,x as E,c as $,I as S,A as k,aw as I,ax as V}from"./icon-04f6a077.js";import"./faceplate-radio-input-4737b7b4.js";import"./faceplate-text-input-999c3dd8.js";import{l as C,L as R}from"./list-item-b879d870.js";import"./faceplate-modal-b5af7f91.js";import"./faceplate-switch-input-17cfc01a.js";import{c as N,V as T,a as M}from"./index-daf57838.js";import"./checked-input-element-a822f47d.js";import"./faceplate-input-dc5282a4.js";import"./input-element-2bee98eb.js";import"./form-common-utils-d3476c65.js";import"./live-2ab1644c.js";import"./text-input-5a8d8b87.js";const j=[{getLabel:()=>"Public",value:t.Public,getDescription:()=>"Anyone can view, post, and comment to this community",icon:p(),iconSelected:h()},{getLabel:()=>"Restricted",value:t.Restricted,getDescription:()=>"Anyone can view, but only approved users can contribute",icon:f(),iconSelected:b()},{getLabel:()=>"Private",value:t.Private,getDescription:()=>"Only approved users can view and submit to this community",icon:y(),iconSelected:v()},{adminRequired:!0,getLabel:()=>"Employee-only",value:t.EmployeesOnly,getDescription:()=>"Only Reddit employees can view and contribute",icon:g(),iconSelected:_()}],D=`${window.CLIENT_CONFIG?.STATIC_BASE_URL}assets/snoomojis/care.png`,L=e=>E`\n <div class="mb-xs">\n <h4 class="text-14 font-semibold mb-xs">${"Type"}</h4>\n <ul role="menu" class="pl-0">\n ${j.map((t=>t.adminRequired&&!e.isAdmin?k:((e,t)=>{const a=t.value===e._typeValue;return E`<label>\n ${C({onClick:()=>e._typeValue=t.value,label:t.getLabel(),size:R.Medium,attributes:{role:"menuitemradio"},innerClassName_DO_NOT_USE:"rounded-[12px]",leadingIcon:a?t.iconSelected:t.icon,trailingSlot:E`<faceplate-radio-input \n class="m-0" \n @input="${e.typeInputChangeHandler}" \n ?checked="${a}" \n name="${A.Type}" \n value="${t.value}" \n></faceplate-radio-input>`,description:t.getDescription(),selected:a})}\n </label>`})(e,t)))}\n </ul>\n </div>\n`;var A;!function(e){e.Name="name",e.Type="type",e.NSFW="isNsfw"}(A||(A={}));let B=window.location;const H=a(x);let O=class extends H{constructor(){super(...arguments),this.isAdmin=!1,this._nameValue="",this._typeValue=t.Public,this._nsfwValue=!1,this.modalRef=l(),this._loading=!1,this._submitError=!1,this._validationError=null,this.onToggle=e=>{e.stopPropagation(),this.modalRef.value.showModal()}}get nameInput(){return this.modalRef.value?.querySelector('faceplate-text-input[name="name"]')}get nameInputHelperText(){return this.nameInput?.shadowRoot?.querySelector('faceplate-form-helper-text[name="name"]')}showModal(){this.modalRef.value?.showModal()}closeModal(){this.modalRef.value.close(),this.trackEvent(e({source:"community_form",action:"click",noun:"cancel"}))}closeButtonHandler(e){this.closeModal(),e.preventDefault()}closeButtonImgKeyDownHandler(e){e.preventDefault(),"Enter"!==e.key&&" "!==e.key||this.closeModal()}nameInputChangeHandler(e){this.resetNameInputValidation(),this._nameValue=e.target.value}typeInputChangeHandler(e){this._typeValue=e.target.value}setNameInputTakenValidationMessage(){this.nameInputHelperText?.setMessage(`r/${this._nameValue} is already taken`,r.error),this.nameInput?.setCustomValidity("invalid")}resetNameInputValidation(){this.nameInputHelperText?.setMessage(""),this.nameInput?.setCustomValidity(""),this.clearErrorState()}clearErrorState(){this.shadowRoot?.querySelectorAll("faceplate-toast").forEach((e=>e.dismiss())),this._validationError=null,this._submitError=!1}async connectedCallback(){super.connectedCallback(),await this.updateComplete,Array.from(this.querySelectorAll("[data-modal-toggle]")).forEach((e=>{e.addEventListener("click",this.onToggle)}))}disconnectedCallback(){super.disconnectedCallback(),Array.from(this.querySelectorAll("[data-modal-toggle]")).forEach((e=>{e.removeEventListener("click",this.onToggle)}))}async handleSubmit(){var t;this._loading=!0,this.trackEvent((t={setting_value:this._typeValue},e({source:"community_form",action:"click",noun:"save_community_button"},{action_info:t}))),await this.createSubredditMutation(),this._loading=!1}async createSubredditMutation(){this.clearErrorState();const t={name:this._nameValue,isNsfw:this._nsfwValue,type:this._typeValue,publicDescription:""};try{const e=await N(t);if(!e||!e.path)throw new Error("Failed to create subreddit. No path returned.");{this.modalRef.value?.close(),void 0!==this.nameInput&&null!==this.nameInput&&(this.nameInput.value="");const t=new URL(B.href);t.pathname=e.path,B.href=t.href}}catch(t){t instanceof T&&(this._validationError=t,t.reason===M.SUBREDDIT_EXISTS&&this.setNameInputTakenValidationMessage()),this._submitError=!0,this.trackEvent((a={setting_value:this._nameValue,reason:t?.reason||"SERVER_ERROR"},e({source:"community_form",action:"view",noun:"error_message"},{action_info:a})))}var a}render(){const e="Close Form and Cancel creating a community";return E` <slot></slot>\n <faceplate-modal ${c(this.modalRef)} class="max-w-[400px] xs:max-w-[500px]">\n <div slot="titleGraphic" class="w-2xl h-2xl">\n <faceplate-img src="${D}"></faceplate-img>\n </div>\n <div slot="title" class="flex flex-column xs:flex-row">\n <span class="text-18 xs:text-24 font-semibold">${"Create a community"}</span>\n </div>\n <div \n class="flex items-center" \n slot="closeButton" \n tabindex="0" \n @click="${this.closeButtonHandler}" \n @keydown="${this.closeButtonImgKeyDownHandler}" \n>\n ${u({appearance:"secondary",leadingIcon:$({size:S.Small}),size:m.Small,attributes:{title:e}})}\n </div>\n <faceplate-form class="mb-0" method="log">\n <p class="-mt-2xs mb-sm text-neutral-content">${"Build and grow a community about something you care about. We'll help you set things up."}</p>\n ${t=this,E`\n <faceplate-text-input \n data-testid="name-input" \n class="block" \n type="text" \n name="${A.Name}" \n minlength="3" \n maxlength="21" \n required\n @input="${t.nameInputChangeHandler}" \n helper-text-placeholder="${"Choose wisely. Once you pick a name, it can't be changed."}" \n character-count\n>\n <span slot="label">${"Name"}</span>\n </faceplate-text-input>\n`} ${L(this)}\n <hr \n class="border-0 border-b-sm border-solid border-b-neutral-border-weak mt-2xs mb-2xs" \n>\n <ul role="menu" class="pl-0 mb-md">\n ${(e=>{const t=e._nsfwValue;return E`\n ${C({onClick:()=>e._nsfwValue=!t,label:"Mature (18+) ",attributes:{role:"menuitemcheckbox"},innerClassName_DO_NOT_USE:"rounded-[12px]",size:R.Medium,leadingIcon:I(),trailingSlot:E`\n <faceplate-switch-input \n data-testid="nsfw-input" \n \n name="${A.NSFW}" \n ?checked="${t}" \n>\n </faceplate-switch-input>\n `,description:"Must be over 18 to view and contribute"})}\n `})(this)}\n </ul>\n <div class="flex justify-end">\n ${u({appearance:"secondary",attributes:{slot:"secondaryButton",onclick:this.closeButtonHandler,title:e},children:"Cancel",size:m.Large})}\n ${(e=>{const t=e._nameValue?`Create r/${e._nameValue}`:"Create your community";return u({appearance:"primary",attributes:{className:"ml-sm","data-testid":"submit-button",type:"submit",disabled:!e._nameValue||e._loading,slot:"primaryButton",onclick:e.handleSubmit},children:t,size:m.Large})})(this)}\n </div>\n </faceplate-form>\n ${(e=>E`\n <faceplate-alert-reporter>\n <faceplate-toaster> </faceplate-toaster>\n ${e._submitError&&!e._validationError?E`<faceplate-alert \n level="error" \n message="Something went wrong. Please try again." \n></faceplate-alert>`:""}\n ${V(e._validationError?.fieldErrors||[],(e=>e.field),(e=>E` <faceplate-alert \n level="error" \n message="${e.message}" \n></faceplate-alert>`))}\n </faceplate-alert-reporter>\n `)(this)}\n </faceplate-modal>`;var t}};O.styles=[w`:host{display:block;position:relative;z-index:5}`,n],i([s({type:Boolean,attribute:"is-admin"})],O.prototype,"isAdmin",void 0),i([o()],O.prototype,"_nameValue",void 0),i([o()],O.prototype,"_typeValue",void 0),i([o()],O.prototype,"_nsfwValue",void 0),i([o()],O.prototype,"_loading",void 0),i([o()],O.prototype,"_submitError",void 0),i([o()],O.prototype,"_validationError",void 0),O=i([d("community-creation-modal")],O);
//# sourceMappingURL=community-creation-modal-client-js-a7d421af.js.map
